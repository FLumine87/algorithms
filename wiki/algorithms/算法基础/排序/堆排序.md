## å®šä¹‰[](https://oi-wiki.org/basic/heap-sort/#%E5%AE%9A%E4%B9%89 "Permanent link")

å †æ’åºï¼ˆè‹±è¯­ï¼šHeapsortï¼‰æ˜¯æŒ‡åˆ©ç”¨Â [äºŒå‰å †](https://oi-wiki.org/ds/binary-heap/)Â è¿™ç§æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ã€‚å †æ’åºçš„é€‚ç”¨æ•°æ®ç»“æ„ä¸º**æ•°ç»„**ã€‚

## è¿‡ç¨‹[](https://oi-wiki.org/basic/heap-sort/#%E8%BF%87%E7%A8%8B "Permanent link")

å †æ’åºçš„æœ¬è´¨æ˜¯**å»ºç«‹åœ¨å †ä¸Šçš„é€‰æ‹©æ’åº**ã€‚

### æ’åº[](https://oi-wiki.org/basic/heap-sort/#%E6%8E%92%E5%BA%8F "Permanent link")

é¦–å…ˆå»ºç«‹å¤§é¡¶å †ï¼Œç„¶åå°†å †é¡¶çš„å…ƒç´ å–å‡ºï¼Œä½œä¸ºæœ€å¤§å€¼ï¼Œä¸æ•°ç»„å°¾éƒ¨çš„å…ƒç´ äº¤æ¢ï¼Œå¹¶ç»´æŒæ®‹ä½™å †çš„æ€§è´¨ï¼›

ä¹‹åå°†å †é¡¶çš„å…ƒç´ å–å‡ºï¼Œä½œä¸ºæ¬¡å¤§å€¼ï¼Œä¸æ•°ç»„å€’æ•°ç¬¬äºŒä½å…ƒç´ äº¤æ¢ï¼Œå¹¶ç»´æŒæ®‹ä½™å †çš„æ€§è´¨ï¼›

ä»¥æ­¤ç±»æ¨ï¼Œåœ¨ç¬¬Â ğ‘›Â âˆ’1![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "n-1")Â æ¬¡æ“ä½œåï¼Œæ•´ä¸ªæ•°ç»„å°±å®Œæˆäº†æ’åºã€‚

### åœ¨æ•°ç»„ä¸Šå»ºç«‹äºŒå‰å †[](https://oi-wiki.org/basic/heap-sort/#%E5%9C%A8%E6%95%B0%E7%BB%84%E4%B8%8A%E5%BB%BA%E7%AB%8B%E4%BA%8C%E5%8F%89%E5%A0%86 "Permanent link")

ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡å°†æ¯ä¸€å±‚çš„èŠ‚ç‚¹æ’åˆ—åœ¨æ•°ç»„é‡Œã€‚

äºæ˜¯æœ‰æ•°ç»„ä¸­ä¸‹æ ‡ä¸ºÂ `i`Â çš„èŠ‚ç‚¹ï¼Œå¯¹åº”çš„çˆ¶ç»“ç‚¹ã€å·¦å­ç»“ç‚¹å’Œå³å­ç»“ç‚¹å¦‚ä¸‹ï¼š
```c
iParent(i) = (i - 1) / 2;
iLeftChild(i) = 2 * i + 1;
iRightChild(i) = 2 * i + 2;
```
## æ€§è´¨[](https://oi-wiki.org/basic/heap-sort/#%E6%80%A7%E8%B4%A8 "Permanent link")

### ç¨³å®šæ€§[](https://oi-wiki.org/basic/heap-sort/#%E7%A8%B3%E5%AE%9A%E6%80%A7 "Permanent link")

åŒé€‰æ‹©æ’åºä¸€æ ·ï¼Œç”±äºå…¶ä¸­äº¤æ¢ä½ç½®çš„æ“ä½œï¼Œæ‰€ä»¥æ˜¯ä¸ç¨³å®šçš„æ’åºç®—æ³•ã€‚

### æ—¶é—´å¤æ‚åº¦[](https://oi-wiki.org/basic/heap-sort/#%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6 "Permanent link")

å †æ’åºçš„æœ€ä¼˜æ—¶é—´å¤æ‚åº¦ã€å¹³å‡æ—¶é—´å¤æ‚åº¦ã€æœ€åæ—¶é—´å¤æ‚åº¦å‡ä¸ºÂ ğ‘‚(ğ‘›logâ¡ğ‘›)![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 "O(n\log n)")ã€‚

### ç©ºé—´å¤æ‚åº¦[](https://oi-wiki.org/basic/heap-sort/#%E7%A9%BA%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6 "Permanent link")

ç”±äºå¯ä»¥åœ¨è¾“å…¥æ•°ç»„ä¸Šå»ºç«‹å †ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªåŸåœ°ç®—æ³•ã€‚

## å®ç°[](https://oi-wiki.org/basic/heap-sort/#%E5%AE%9E%E7%8E%B0 "Permanent link")
```cpp
void sift_down(int arr[], int start, int end) {//æ³¡æ³¡ä¸‹é™
  // è®¡ç®—çˆ¶ç»“ç‚¹å’Œå­ç»“ç‚¹çš„ä¸‹æ ‡
  int parent = start;
  int child = parent * 2 + 1;
  while (child <= end) {  // å­ç»“ç‚¹ä¸‹æ ‡åœ¨èŒƒå›´å†…æ‰åšæ¯”è¾ƒ
    // å…ˆæ¯”è¾ƒä¸¤ä¸ªå­ç»“ç‚¹å¤§å°ï¼Œé€‰æ‹©æœ€å¤§çš„
    if (child + 1 <= end && arr[child] < arr[child + 1]) child++;
    // å¦‚æœçˆ¶ç»“ç‚¹æ¯”å­ç»“ç‚¹å¤§ï¼Œä»£è¡¨è°ƒæ•´å®Œæ¯•ï¼Œç›´æ¥è·³å‡ºå‡½æ•°
    if (arr[parent] >= arr[child])
      return;
    else {  // å¦åˆ™äº¤æ¢çˆ¶å­å†…å®¹ï¼Œå­ç»“ç‚¹å†å’Œå­™ç»“ç‚¹æ¯”è¾ƒ
      swap(arr[parent], arr[child]);
      parent = child;
      child = parent * 2 + 1;
    }
  }
}

void heap_sort(int arr[], int len) {
  // ä»æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å¼€å§‹ sift down ä»¥å®Œæˆå †åŒ– (heapify)
  for (int i = (len - 1 - 1) / 2; i >= 0; i--) sift_down(arr, i, len - 1);
  // å…ˆå°†ç¬¬ä¸€ä¸ªå…ƒç´ å’Œå·²ç»æ’å¥½çš„å…ƒç´ å‰ä¸€ä½åšäº¤æ¢ï¼Œå†é‡æ–°è°ƒæ•´ï¼ˆåˆšè°ƒæ•´çš„å…ƒç´ ä¹‹å‰çš„å…ƒç´ ï¼‰ï¼Œç›´åˆ°æ’åºå®Œæ¯•
  for (int i = len - 1; i > 0; i--) {
    swap(arr[0], arr[i]);
    sift_down(arr, 0, i - 1);
  }
}
```