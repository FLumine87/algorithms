### 摩尔机（Moore Machine）详解：以智能交通灯控制系统为例

#### 一、摩尔机的核心特性

- **定义**：摩尔机是有限状态机（FSM）的一种，其输出仅由当前状态决定，与输入信号无关。
- **与 Mealy 机的区别**： Mealy 机的输出同时依赖当前状态和输入，而摩尔机的输出逻辑更简单，稳定性更高（输出仅在状态切换时变化）。

#### 二、智能交通灯控制系统案例

##### 1. **系统背景与需求**

- **场景**：控制 Union Street 与 Union Row/Bon Accord Street 的交叉路口交通灯。
- **输入**：
    - $T_A$：Union Row/Bon Accord Street 方向的交通传感器（检测到车辆时为 TRUE）。
    - $T_B$：Union Street 方向的交通传感器（检测到车辆时为 TRUE）。
- **输出**：
    - $L_A$：Union Row/Bon Accord Street 方向的信号灯（红、绿、黄）。
    - $L_B$：Union Street 方向的信号灯（红、绿、黄）。
- **状态切换规则**：
    - 每 4 秒切换一次状态，除非当前为绿灯且有车辆检测，此时保持绿灯。

##### 2. **状态定义与转移逻辑**

- **状态划分**：
    
    - $S_a$：UR-BA-Green（Union Row/Bon Accord Street 方向绿灯，Union Street 方向红灯）。
    - $S_b$：UR-BA-Amber（Union Row/Bon Accord Street 方向黄灯，Union Street 方向红灯）。
    - $S_c$：UNIONST-Green（Union Street 方向绿灯，Union Row/Bon Accord Street 方向红灯）。
    - $S_d$：UNIONST-Amber（Union Street 方向黄灯，Union Row/Bon Accord Street 方向红灯）。
- **状态转移表**： 

| 当前状态（S）                 |  $T_A$  |  $T_B$  | 下一状态（$S'$）            |
| ----------------------- | --------- | --------- | ----------------------- |
|  $S_a$（UR-BA-Green）   | 0         | X         |  $S_b$（UR-BA-Amber）   |
|  $S_a$                | 1         | X         |  $S_a$（保持绿灯）          |
|  $S_b$（UR-BA-Amber）   | X         | X         |  $S_c$（UNIONST-Green） |
|  $S_c$（UNIONST-Green） | X         | 0         |  $S_d$（UNIONST-Amber） |
|  $S_c$                | X         | 1         |  $S_c$（保持绿灯）          |
|  $S_d$（UNIONST-Amber） | X         | X         |  $S_a$（UR-BA-Green）   |
    
- **转移逻辑说明**：
    
    - 当 Union Row 方向为绿灯（$S_a$）时，若检测到车辆（$T_A=1$），则保持绿灯；若无车辆（$T_A=0$），4 秒后切换为黄灯（$S_b$）。
    - 黄灯状态（$S_b$或$S_d$）无论是否有车辆，4 秒后均切换至对向绿灯状态。
    - Union Street 方向绿灯（$S_c$）时，若检测到车辆（$T_B=1$），保持绿灯；若无车辆（$T_B=0$），切换为黄灯（$S_d$）。

##### 3. **状态编码与二进制表示**

为将状态转换为电路可实现的二进制信号，需对状态进行编码：

  

| 状态      | 二进制编码（$Q_1Q_0$） |
| ------- | ----------------- |
| $S_a$ | 00                |
| $S_b$ | 01                |
| $S_c$ | 10                |
| $S_d$ | 11                |

##### 4. **状态方程推导**

通过状态转移表和编码，可得到下一状态的逻辑表达式（使用卡诺图化简）：

  

- $Q_1^+ = \overline{Q_1}Q_0 + Q_1\overline{Q_0}$ （解释：当当前状态为$S_a$（00）或$S_c$（10）时，根据输入切换至$S_b$（01）或$S_d$（11），体现状态循环切换逻辑。）
- $Q_0^+ = \overline{Q_1}\overline{Q_0}\overline{T_A} + Q_1\overline{Q_0}\overline{T_B}$ （解释：$Q_0$的更新依赖于当前状态和输入，例如当状态为$S_a$（$Q_1Q_0=00$）且$T_A=0$时，$Q_0^+=1$，切换至$S_b$（01）。）

##### 5. **输出编码与方程**

- **信号灯输出的二进制表示**： 假设用 2 位二进制数表示每个信号灯的颜色：
    
    - 红灯：00，黄灯：01，绿灯：10。 则输出变量定义为：
    - $L_{a1}L_{a0}$：Union Row 方向信号灯（$L_A$）。
    - $L_{b1}L_{b0}$：Union Street 方向信号灯（$L_B$）。
- **输出编码表**： 
| 状态 | $Q_1Q_0$ | $L_{a1}$ | $L_{a0}$ | $L_{b1}$ | $L_{b0}$ | 
|--------|------------|------------|------------|------------|------------| 
| $S_a$ | 00 | 0 | 0 | 1 | 0 | （$L_A$红灯，$L_B$绿灯） | $S_b$ | 01 | 0 | 1 | 1 | 0 | （$L_A$黄灯，$L_B$绿灯） | $S_c$ | 10 | 1 | 0 | 0 | 0 | （$L_A$红灯，$L_B$绿灯） | $S_d$ | 11 | 1 | 0 | 0 | 1 | （$L_A$红灯，$L_B$黄灯）
    
- **输出方程**： 由输出编码表可得逻辑表达式：
    
    - $L_{a1} = Q_1$
    - $L_{a0} = \overline{Q_1}Q_0$
    - $L_{b1} = \overline{Q_1}$
    - $L_{b0} = Q_1Q_0$ （说明：输出仅由状态编码$Q_1Q_0$决定，符合摩尔机特性。）

#### 三、摩尔机的电路实现

##### 1. **核心组件**

- **状态寄存器**：存储当前状态编码$Q_1Q_0$，通常由 D 触发器实现。
- **组合逻辑电路**：
    - 状态转移逻辑：根据当前状态和输入$T_A,T_B$计算下一状态$Q_1^+,Q_0^+$。
    - 输出逻辑：根据当前状态计算信号灯输出$L_{a1},L_{a0},L_{b1},L_{b0}$。

##### 2. **关键方程映射**

- 状态转移逻辑对应方程：$Q_1^+ = \overline{Q_1}Q_0 + Q_1\overline{Q_0}$$Q_0^+ = \overline{Q_1}\overline{Q_0}\overline{T_A} + Q_1\overline{Q_0}\overline{T_B}$
- 输出逻辑对应方程：$L_{a1}=Q_1$, $L_{a0}=\overline{Q_1}Q_0$, $L_{b1}=\overline{Q_1}$, $L_{b0}=Q_1Q_0$

#### 四、摩尔机的优势与应用场景

- **优势**：
    - 输出仅依赖状态，抗干扰能力强（输入波动不直接影响输出）。
    - 状态与输出的对应关系清晰，便于设计和调试。
- **应用场景**：
    - 数字电路控制（如交通灯、电梯控制）。
    - 通信协议状态机（如 UART、SPI 接口控制）。
    - 嵌入式系统中的状态管理（如设备待机、工作、报错状态切换）